<!-- estadisticas.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Estadísticas en Tiempo Real</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        .chart {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <div id="graficoBarras" class="chart"></div>
        <div id="graficoAnillo" class="chart"></div>
    </div>

    <script>
        function actualizarGraficos() {
            fetch('/datos_estadisticas')
                .then(response => response.json())
                .then(data => {
                    // Actualizar gráfico de barras horizontales
                    let estados = data.estados;
                    console.log(estados);
                    Plotly.react('graficoBarras', [{
                        type: 'bar',
                        x: estados.map(item => item.cantidad),
                        y: estados.map(item => item.nombre),
                        hoverinfo: 'label+percent+value+name',
                        orientation: 'h',
                        marker: {
                            color: '#4CAF50'
                        },
                        text: data.estados.map(item => `${item.nombre}: ${item.cantidad}`),
                        textposition: 'auto',
                        hoverinfo: 'none', // Desactivar tooltip por defecto
                        hovertemplate: '<b>%{y}</b><br>Cantidad: %{x}<extra></extra>'

                    }], {
                        title: 'Estados de Gestión',
                        margin: {l: 150}
                    });

                    // Actualizar gráfico de anillo
                    let tipificaciones = data.tipificaciones;
                    console.log(tipificaciones);
                    Plotly.react('graficoAnillo', [{
                        values: tipificaciones.map(item => item.cantidad),
                        labels: tipificaciones.map(item => item.nombre),
                        hoverinfo: 'label+percent+value+name',
                        hole: 0.4,
                        type: 'pie',
                        marker: {
                            colors: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                            
                        },
                        textinfo: 'label+percent+value',
                        texttemplate: '<b>%{label}</b><br>%{value} gestiones<br>(%{percent})',
                        hoverinfo: 'label+percent+value',
                        hovertemplate: '<b>%{label}</b><br>Total: %{value}<br>Porcentaje: %{percent}<extra></extra>'
                    }], {
                        title: 'Tipificaciones'
                    });
                });
        }

        // Actualizar cada 5 segundos
        setInterval(actualizarGraficos, 5000);
        
        // Cargar inicialmente
        actualizarGraficos();
    </script>
</body>
</html>
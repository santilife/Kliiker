<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --color-primario: #2c3e50;
            --color-secundario: #3498db;
            --color-fondo: #f8f9fa;
        }

        body {
            background-color: var(--color-fondo);
            min-height: 100vh;
        }

        .navbar-custom {
            background-color: var(--color-primario) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo-header {
            height: 40px;
            margin-right: 15px;
        }

        .nav-link {
            color: white !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--color-secundario) !important;
            transform: translateY(-2px);
        }

        .container.mt-4 {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }

        .tabs {
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            padding: 10px 25px;
            border: none;
            background: none;
            color: #6c757d;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--color-primario);
            border-bottom: 3px solid var(--color-secundario);
        }

        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.005);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .btn-tab {
            color: var(--color-primario);
            padding: 0;
            font-weight: 500;
        }

        .btn-tab:hover {
            color: var(--color-secundario);
            text-decoration: underline;
        }

        .search-container {
            flex-grow: 1;
            max-width: 400px;
        }

        .modal-content {
            border-radius: 10px;
            border: none;
        }

        .modal-header {
            background-color: var(--color-primario);
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .form-control:focus {
            border-color: var(--color-secundario);
            box-shadow: 0 0 0 0.2rem rgba(52,152,219,0.25);
        }
    </style>
  </head>
  <body>

    <!-- BARRA DE NAVEGACIÓN -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-custom">
      <div class="container-fluid">
        <img
          src="../../static/img/LogoKliiker.png"
          class="logo-header me-3"
          alt="Logo Kliiker"
        />

        <div class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="#">Gestión</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../estadisticas/estadisticas.html"
                >Estadísticas</a
              >
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#">Administrativo</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../asesores/index.html">Asesor</a>
            </li>
          </ul>
          <span class="navbar-text me-3">Hola {{session["usuario"]}}</span>
          <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger"
            >Cerrar sesión</a
          >
        </div>
      </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="search-container">
          <input type="search" id="searchInput" class="form-control" placeholder="Buscar..." />
        </div>
        <img
          src="../../static/img/LogoAndes.png"
          class="logo-header"
          alt="Logo Andes"
        />
      </div>

         <!-- Pestañas -->
         <div class="tabs">
          <button class="tab active" onclick="mostrarTabla('asesor')">asesor</button>
        </div>


           <!-- ----------------------------------------------------------------------- -->
      <!--                              Tabla asesor                           -->
      <!-- ----------------------------------------------------------------------- -->
      <div class="table-responsive" id="asesorTable">
        <table class="table table-hover tabla-datos" id="asesorTableBuscar">
          <thead class="table-light">
            <tr>
              <th>Nombre completo</th>
              <th>Documento</th>
              <th>Usuario</th>
              <th>Rol</th>
            </tr>
          </thead>
          <tbody>
            {% for fila in datos %}
            <tr>
              <td>
                <button
                class="btn btn-link btn-tab text-decoration-none"
                data-bs-toggle="modal"
                data-bs-target="#detalleModal"
                data-idGestion="{{fila.nombre_AS}}"
                data-id="{{ fila.documento }}"
                data-nombre="{{ fila.usuario }}"
                data-apellido="{{ fila.rol }}"
                >
                {{ fila.nombre }}
                </button>
              </td>
              <td>{{ fila.nombre_AS }}</td>
              <td>{{ fila.documento }}</td>
              <td>{{ fila.usuario }}</td>
              <td>{{ fila.rol }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>


    <!-- -------------------------------- Modal -------------------------------- -->
    <div class="modal fade" id="detalleModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Agregar asesor</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form method="POST" action="">
            <div class="modal-body">
              <input type="hidden" name="asesor_AS" id="modalasesor_AS">

              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <label class="form-label">Nombre completo</label>
                  <input
                    type="text"
                    class="form-control"
                    name="nombre_AS"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Documento de identidad</label>
                  <input
                    type="number"
                    class="form-control"
                    name="documento"
                    required
                  />
                </div>

                <div class="col-md-6">
                <label class="form-label">Rol</label>
                  <select class="form-select" name="rol" required>
                    <option value="">Seleccione</option>
                    <option value="administrador">Administrador</option>
                    <option value="asesor">Asesor</option>
                  </select>
                </div>
              </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cerrar
              </button>
              <button type="submit" class="btn btn-primary">
                Guardar Cambios
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
<script>     
// Script para manejar los datos del modal - Versión Mejorada
document.getElementById("detalleModal").addEventListener("show.bs.modal", function(event) {
    const button = event.relatedTarget;
    const modal = this;
    
    // Mapeo completo de datos
    const fieldMappings = {
        '#modalasesor_AS': 'asesor_AS',
        'input[name="nombres_AS"]': 'nombre_AS',
        'input[name="documento"]': 'documento',
        'select[name="rol"]': 'rol'
      };

    // Poblar todos los campos
    Object.entries(fieldMappings).forEach(([selector, dataField]) => {
        const element = modal.querySelector(selector);
        const value = button.dataset[dataField];
        
        if (element) {
            if (element.tagName === 'SELECT') {
                Array.from(element.options).forEach(option => {
                    option.selected = option.value === value;
                });
            } else {
                element.value = value || '';
            }
        }
    });
});
// ------------------------------------------------------------------------------------
    // Buscar
    document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM cargado"); // Verifica que el DOM esté listo

        const input = document.getElementById("searchInput");
        const table = document.getElementById("asesorTableBuscar");

        console.log("Campo de búsqueda:", input); // Verifica si el campo de búsqueda se encuentra
        console.log("Tabla:", table); // Verifica si la tabla se encuentra

        if (!input || !table ) {
            console.error("No se encontraron los elementos necesarios.");
            return;
        }

        // Función para buscar en la tabla
        function buscarEnTabla() {
            const filter = input.value.toUpperCase();
            const rows = table.getElementsByTagName("tr");

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName("td");
                let mostrarFila = false;

                for (let j = 0; j < cells.length; j++) {
                    const cell = cells[j];
                    if (cell) {
                        const text = cell.textContent || cell.innerText;
                        if (text.toUpperCase().indexOf(filter) > -1) {
                            mostrarFila = true;
                            break;
                        }
                    }
                }

                if (mostrarFila) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            }
        }

        // Escuchar el evento "input" en el campo de búsqueda
        input.addEventListener("input", buscarEnTabla);
    });
    // <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</script>
  </body>
</html>